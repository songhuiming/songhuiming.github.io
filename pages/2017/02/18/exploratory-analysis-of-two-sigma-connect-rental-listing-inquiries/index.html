<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Exploratory analysis of Two Sigma Connect: Rental Listing Inquiries &mdash; pydata by Huiming</title>
  <meta name="author" content="shm">


    
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
        MathJax.Hub.Config({
            config: ["MMLorHTML.js"],
            extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js"],
            jax: ["input/TeX"],
            tex2jax: {
                inlineMath: [ ['$','$'], ["\(","\)"] ],
                displayMath: [ ['$$','$$'], ["\[","\]"] ],
                processEscapes: false
            },
            TeX: {
                TagSide: "right",
                TagIndent: ".8em",
                MultLineWidth: "85%",
                equationNumbers: {
                   autoNumber: "AMS",
                },
                unicode: {
                   fonts: "STIXGeneral,'Arial Unicode MS'"
                }
            },
            showProcessingMessages: false
        });
</script>




  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="/favicon.png" rel="icon">

  <link href="/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">

  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="/">pydata by Huiming</a></h1>
    <h2>Keep Looking, Don't Settle</h2>
</hgroup>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
        MathJax.Hub.Config({
            config: ["MMLorHTML.js"],
            extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js"],
            jax: ["input/TeX"],
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                processEscapes: false
            },
            TeX: {
                TagSide: "right",
                TagIndent: ".8em",
                MultLineWidth: "85%",
                equationNumbers: {
                   autoNumber: "AMS",
                },
                unicode: {
                   fonts: "STIXGeneral,'Arial Unicode MS'"
                }
            },
            showProcessingMessages: false
        });
</script></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>

<form class="search" action="/search.html">
    <input type="text" class="search-query" placeholder="Search" name="q" id="s">
</form>

<form action="https://www.google.com/search" method="get">
    <fieldset role="search">
       <input type="hidden" name="q" value="site:songhuiming.github.io" />
       <input class="search" type="text" name="q" results="0" placeholder="Search"/>
    </fieldset>
</form>


<ul class="main-navigation">
    <li><a href="/functions/archives.html">Archives</a></li>
      <li >
        <a href="/category/career-growth.html">Career growth</a>
      </li>
      <li >
        <a href="/category/linux.html">Linux</a>
      </li>
      <li class="active">
        <a href="/category/python.html">Python</a>
      </li>
      <li >
        <a href="/category/rthers.html">Rthers</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">Exploratory analysis of Two Sigma Connect: Rental Listing Inquiries</h1>
    <p class="meta">
<time datetime="2017-02-18T00:00:00-06:00" pubdate>Sat 18 February 2017</time>    </p>
</header>

  <div class="entry-content"><h2>0. Introduction</h2>
<p>Finding the perfect place to call your new home should be more than browsing through endless listings. RentHop makes apartment search smarter by using data to sort rental listings by quality. But while looking for the perfect apartment is difficult enough, structuring and making sense of all available real estate data programmatically is even harder. Two Sigma and RentHop, a portfolio company of Two Sigma Ventures, invite Kagglers to unleash their creative engines to uncover business value in this unique recruiting competition.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> 
<span class="kn">import</span> <span class="nn">matplotlib</span>  
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span> 
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">color</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">()</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;../indata/train.json&quot;</span><span class="p">)</span>


<span class="nb">print</span> <span class="n">train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="w">        </span><span class="nx">bathrooms</span><span class="w">  </span><span class="nx">bedrooms</span><span class="w">                       </span><span class="nx">building_id</span><span class="w">  </span>\
<span class="mi">10</span><span class="w">            </span><span class="m m-Double">1.5</span><span class="w">         </span><span class="mi">3</span><span class="w">  </span><span class="mi">53</span><span class="nx">a5b119ba8f7b61d4e010512e0dfc85</span><span class="w">   </span>
<span class="mi">10000</span><span class="w">         </span><span class="m m-Double">1.0</span><span class="w">         </span><span class="mi">2</span><span class="w">  </span><span class="nx">c5c8a357cba207596b04d1afd1e4f130</span><span class="w">   </span>
<span class="mi">100004</span><span class="w">        </span><span class="m m-Double">1.0</span><span class="w">         </span><span class="mi">1</span><span class="w">  </span><span class="nx">c3ba40552e2120b0acfc3cb5730bb2aa</span><span class="w">   </span>
<span class="mi">100007</span><span class="w">        </span><span class="m m-Double">1.0</span><span class="w">         </span><span class="mi">1</span><span class="w">  </span><span class="mi">28</span><span class="nx">d9ad350afeaab8027513a3e52ac8d5</span><span class="w">   </span>
<span class="mi">100013</span><span class="w">        </span><span class="m m-Double">1.0</span><span class="w">         </span><span class="mi">4</span><span class="w">                                 </span><span class="mi">0</span>

<span class="w">                    </span><span class="nx">created</span><span class="w">  </span>\
<span class="mi">10</span><span class="w">      </span><span class="mi">2016</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">24</span><span class="w"> </span><span class="mi">07</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">24</span><span class="w">   </span>
<span class="mi">10000</span><span class="w">   </span><span class="mi">2016</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">12</span><span class="w"> </span><span class="mi">12</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">27</span><span class="w">   </span>
<span class="mi">100004</span><span class="w">  </span><span class="mi">2016</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">17</span><span class="w"> </span><span class="mi">03</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">41</span><span class="w">   </span>
<span class="mi">100007</span><span class="w">  </span><span class="mi">2016</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">18</span><span class="w"> </span><span class="mi">02</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">02</span><span class="w">   </span>
<span class="mi">100013</span><span class="w">  </span><span class="mi">2016</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">01</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mi">41</span>

<span class="w">                                              </span><span class="nx">description</span><span class="w">  </span>\
<span class="mi">10</span><span class="w">      </span><span class="nx">A</span><span class="w"> </span><span class="nx">Brand</span><span class="w"> </span><span class="nx">New</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="nx">Bedroom</span><span class="w"> </span><span class="m m-Double">1.5</span><span class="w"> </span><span class="nx">bath</span><span class="w"> </span><span class="nx">ApartmentEnjoy</span><span class="w"> </span><span class="o">...</span><span class="w">   </span>
<span class="mi">10000</span><span class="w">                                                       </span>
<span class="mi">100004</span><span class="w">  </span><span class="nx">Top</span><span class="w"> </span><span class="nx">Top</span><span class="w"> </span><span class="nx">West</span><span class="w"> </span><span class="nx">Village</span><span class="w"> </span><span class="nx">location</span><span class="p">,</span><span class="w"> </span><span class="nx">beautiful</span><span class="w"> </span><span class="nx">Pre</span><span class="o">-</span><span class="nx">w</span><span class="o">...</span><span class="w">   </span>
<span class="mi">100007</span><span class="w">  </span><span class="nx">Building</span><span class="w"> </span><span class="nx">Amenities</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Garage</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Garden</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">fitness</span><span class="o">...</span><span class="w">   </span>
<span class="mi">100013</span><span class="w">  </span><span class="nx">Beautifully</span><span class="w"> </span><span class="nx">renovated</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="nx">bedroom</span><span class="w"> </span><span class="nx">flex</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="nx">bedroom</span><span class="o">...</span>

<span class="w">            </span><span class="nx">display_address</span><span class="w">  </span>\
<span class="mi">10</span><span class="w">      </span><span class="nx">Metropolitan</span><span class="w"> </span><span class="nx">Avenue</span><span class="w">   </span>
<span class="mi">10000</span><span class="w">       </span><span class="nx">Columbus</span><span class="w"> </span><span class="nx">Avenue</span><span class="w">   </span>
<span class="mi">100004</span><span class="w">          </span><span class="nx">W</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="nx">Street</span><span class="w">   </span>
<span class="mi">100007</span><span class="w">     </span><span class="nx">East</span><span class="w"> </span><span class="mi">49</span><span class="nx">th</span><span class="w"> </span><span class="nx">Street</span><span class="w">   </span>
<span class="mi">100013</span><span class="w">    </span><span class="nx">West</span><span class="w"> </span><span class="mi">143</span><span class="nx">rd</span><span class="w"> </span><span class="nx">Street</span>

<span class="w">                                                 </span><span class="nx">features</span><span class="w"> </span><span class="nx">interest_level</span><span class="w">  </span>\
<span class="mi">10</span><span class="w">                                                     </span><span class="p">[]</span><span class="w">         </span><span class="nx">medium</span><span class="w">   </span>
<span class="mi">10000</span><span class="w">   </span><span class="p">[</span><span class="nx">Doorman</span><span class="p">,</span><span class="w"> </span><span class="nx">Elevator</span><span class="p">,</span><span class="w"> </span><span class="nx">Fitness</span><span class="w"> </span><span class="nx">Center</span><span class="p">,</span><span class="w"> </span><span class="nx">Cats</span><span class="w"> </span><span class="nx">Allow</span><span class="o">...</span><span class="w">            </span><span class="nx">low</span><span class="w">   </span>
<span class="mi">100004</span><span class="w">  </span><span class="p">[</span><span class="nx">Laundry</span><span class="w"> </span><span class="nx">In</span><span class="w"> </span><span class="nx">Building</span><span class="p">,</span><span class="w"> </span><span class="nx">Dishwasher</span><span class="p">,</span><span class="w"> </span><span class="nx">Hardwood</span><span class="w"> </span><span class="nx">Flo</span><span class="o">...</span><span class="w">           </span><span class="nx">high</span><span class="w">   </span>
<span class="mi">100007</span><span class="w">                          </span><span class="p">[</span><span class="nx">Hardwood</span><span class="w"> </span><span class="nx">Floors</span><span class="p">,</span><span class="w"> </span><span class="nx">No</span><span class="w"> </span><span class="nx">Fee</span><span class="p">]</span><span class="w">            </span><span class="nx">low</span><span class="w">   </span>
<span class="mi">100013</span><span class="w">                                          </span><span class="p">[</span><span class="nx">Pre</span><span class="o">-</span><span class="nx">War</span><span class="p">]</span><span class="w">            </span><span class="nx">low</span>

<span class="w">        </span><span class="nx">latitude</span><span class="w">  </span><span class="nx">listing_id</span><span class="w">  </span><span class="nx">longitude</span><span class="w">                        </span><span class="nx">manager_id</span><span class="w">  </span>\
<span class="mi">10</span><span class="w">       </span><span class="m m-Double">40.7145</span><span class="w">     </span><span class="mi">7211212</span><span class="w">   </span><span class="o">-</span><span class="m m-Double">73.9425</span><span class="w">  </span><span class="mi">5</span><span class="nx">ba989232d0489da1b5f2c45f6688adc</span><span class="w">   </span>
<span class="mi">10000</span><span class="w">    </span><span class="m m-Double">40.7947</span><span class="w">     </span><span class="mi">7150865</span><span class="w">   </span><span class="o">-</span><span class="m m-Double">73.9667</span><span class="w">  </span><span class="mi">7533621</span><span class="nx">a882f71e25173b27e3139d83d</span><span class="w">   </span>
<span class="mi">100004</span><span class="w">   </span><span class="m m-Double">40.7388</span><span class="w">     </span><span class="mi">6887163</span><span class="w">   </span><span class="o">-</span><span class="m m-Double">74.0018</span><span class="w">  </span><span class="nx">d9039c43983f6e564b1482b273bd7b01</span><span class="w">   </span>
<span class="mi">100007</span><span class="w">   </span><span class="m m-Double">40.7539</span><span class="w">     </span><span class="mi">6888711</span><span class="w">   </span><span class="o">-</span><span class="m m-Double">73.9677</span><span class="w">  </span><span class="mi">1067</span><span class="nx">e078446a7897d2da493d2f741316</span><span class="w">   </span>
<span class="mi">100013</span><span class="w">   </span><span class="m m-Double">40.8241</span><span class="w">     </span><span class="mi">6934781</span><span class="w">   </span><span class="o">-</span><span class="m m-Double">73.9493</span><span class="w">  </span><span class="mi">98</span><span class="nx">e13ad4b495b9613cef886d79a6291f</span>

<span class="w">                                                   </span><span class="nx">photos</span><span class="w">  </span><span class="nx">price</span><span class="w">  </span>\
<span class="mi">10</span><span class="w">      </span><span class="p">[</span><span class="nx">https</span><span class="p">:</span><span class="c1">//photos.renthop.com/2/7211212_1ed4542e...   3000   </span>
<span class="mi">10000</span><span class="w">   </span><span class="p">[</span><span class="nx">https</span><span class="p">:</span><span class="c1">//photos.renthop.com/2/7150865_be3306c5...   5465   </span>
<span class="mi">100004</span><span class="w">  </span><span class="p">[</span><span class="nx">https</span><span class="p">:</span><span class="c1">//photos.renthop.com/2/6887163_de85c427...   2850   </span>
<span class="mi">100007</span><span class="w">  </span><span class="p">[</span><span class="nx">https</span><span class="p">:</span><span class="c1">//photos.renthop.com/2/6888711_6e660cee...   3275   </span>
<span class="mi">100013</span><span class="w">  </span><span class="p">[</span><span class="nx">https</span><span class="p">:</span><span class="c1">//photos.renthop.com/2/6934781_1fa4b41a...   3350</span>

<span class="w">                 </span><span class="nx">street_address</span><span class="w">  </span>
<span class="mi">10</span><span class="w">      </span><span class="mi">792</span><span class="w"> </span><span class="nx">Metropolitan</span><span class="w"> </span><span class="nx">Avenue</span><span class="w">  </span>
<span class="mi">10000</span><span class="w">       </span><span class="mi">808</span><span class="w"> </span><span class="nx">Columbus</span><span class="w"> </span><span class="nx">Avenue</span><span class="w">  </span>
<span class="mi">100004</span><span class="w">          </span><span class="mi">241</span><span class="w"> </span><span class="nx">W</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="nx">Street</span><span class="w">  </span>
<span class="mi">100007</span><span class="w">     </span><span class="mi">333</span><span class="w"> </span><span class="nx">East</span><span class="w"> </span><span class="mi">49</span><span class="nx">th</span><span class="w"> </span><span class="nx">Street</span><span class="w">  </span>
<span class="mi">100013</span><span class="w">    </span><span class="mi">500</span><span class="w"> </span><span class="nx">West</span><span class="w"> </span><span class="mi">143</span><span class="nx">rd</span><span class="w"> </span><span class="nx">Street</span>
</code></pre></div>

<h2>1. data description</h2>
<p>This part we will learn the data to understand the data better.</p>
<p>There are 49352 observations, 15 variables. interest_level is the response variable to predict with 3 valuesï¼š high, medium and low. bathrooms, bedrooms, latitude, longitude, price are the numeric variables. For apartments, it is likely the cheaper and less bedrooms will be more popular. We can check this later. description and features are the text description or labels about the property. display_address and street_address are the address information.Some apartments may be more popular than the others, we can check if this is true or not later.</p>
<h3>1.1. distribution of interest_level</h3>
<p>The response variable interest_level is character with 3 levels, there is no missing value.</p>
<div class="highlight"><pre><span></span><code><span class="n">train</span><span class="o">.</span><span class="n">interest_level</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nx">low</span><span class="w">       </span><span class="mi">34284</span>
<span class="nx">medium</span><span class="w">    </span><span class="mi">11229</span>
<span class="nx">high</span><span class="w">       </span><span class="mi">3839</span>
<span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">interest_level</span><span class="p">,</span><span class="w"> </span><span class="nx">dtype</span><span class="p">:</span><span class="w"> </span><span class="nx">int64</span>
</code></pre></div>

<h3>1.2. check the distribution / missing of numeric variables</h3>
<p>There is no missing value for the numeric variables, but there are some outliers.</p>
<p>There is max of bathrooms is 10 and the max of bedrooms is 8. The min of bathrooms and bedrooms are 0. Are they condo? Min of latitude is 0 and max is 44.88. Latitude is mostly around 40.7. Min of longitude is -118.27 and max is 0. Most of longitude is around -73.9. Min of prince is 43 and max is 4.49MM. It is very likely latitude, longitude and price has ourliers.</p>
<div class="highlight"><pre><span></span><code><span class="n">train</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bathrooms</th>
      <th>bedrooms</th>
      <th>latitude</th>
      <th>listing_id</th>
      <th>longitude</th>
      <th>price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>49352.00000</td>
      <td>49352.000000</td>
      <td>49352.000000</td>
      <td>4.935200e+04</td>
      <td>49352.000000</td>
      <td>4.935200e+04</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1.21218</td>
      <td>1.541640</td>
      <td>40.741545</td>
      <td>7.024055e+06</td>
      <td>-73.955716</td>
      <td>3.830174e+03</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.50142</td>
      <td>1.115018</td>
      <td>0.638535</td>
      <td>1.262746e+05</td>
      <td>1.177912</td>
      <td>2.206687e+04</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.00000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>6.811957e+06</td>
      <td>-118.271000</td>
      <td>4.300000e+01</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.00000</td>
      <td>1.000000</td>
      <td>40.728300</td>
      <td>6.915888e+06</td>
      <td>-73.991700</td>
      <td>2.500000e+03</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.00000</td>
      <td>1.000000</td>
      <td>40.751800</td>
      <td>7.021070e+06</td>
      <td>-73.977900</td>
      <td>3.150000e+03</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1.00000</td>
      <td>2.000000</td>
      <td>40.774300</td>
      <td>7.128733e+06</td>
      <td>-73.954800</td>
      <td>4.100000e+03</td>
    </tr>
    <tr>
      <th>max</th>
      <td>10.00000</td>
      <td>8.000000</td>
      <td>44.883500</td>
      <td>7.753784e+06</td>
      <td>0.000000</td>
      <td>4.490000e+06</td>
    </tr>
  </tbody>
</table>
</div>

<h3>1.3. check of latitude</h3>
<p>The 1st and 99th percentile of latitude is 40.6404 and 40.862047. So it is reasonable of thinking 0 and 44.8835 as ourliers. We will floor and cap latitude by its 1st and 99th percentile.</p>
<div class="highlight"><pre><span></span><code><span class="n">lat_pct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">99</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="nb">print</span> <span class="n">lat_pct</span>

<span class="n">train</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lat_pct</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_pct</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                             <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">lat_pct</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lat_pct</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]))</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>[40.6404, 40.862047]
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">train</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fb00ff45610&gt;
</code></pre></div>

<p><img alt="png" src="/figures/20170218_twosigma_renthop_01.png"></p>
<h3>1.4. check of longitude</h3>
<p>The 1st and 99th percentile of longitude is -74.0162 and -73.852651. So we will also floot and cap at these two numbers.</p>
<div class="highlight"><pre><span></span><code><span class="n">long_pct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">99</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="nb">print</span> <span class="n">long_pct</span>

<span class="n">train</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">long_pct</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">long_pct</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                             <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">long_pct</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">long_pct</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]))</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>[-74.0162, -73.852651]
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">train</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7faff2c0b490&gt;
</code></pre></div>

<p><img alt="png" src="/figures/20170218_twosigma_renthop_02.png"></p>
<h3>1.5. basemap of latitude and longitude</h3>
<p>Since latitude and longitude indicates the location of the apartment. we can plot them on the basemap to get more intuitive impression about the location.</p>
<p>From the basemap plot, most of the apartments are on the island. It will be better if we can check the y distribution based on the combination of latitude and longitude. But since there are many combinations(more than 10000) of latitude and longitude in the data, it is not good way to do this. But this may indicate that we should re-group latitude and longitude in the model.</p>
<div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;ggplot&#39;</span><span class="p">)</span>
<span class="n">new_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>  
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">new_style</span><span class="p">)</span>  

<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="c1">#Size of figure  </span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="n">P</span><span class="o">=</span><span class="n">train</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">74.02</span><span class="p">,</span> <span class="o">-</span><span class="mf">73.85</span><span class="p">),</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">40.64</span><span class="p">,</span> <span class="mf">40.86</span><span class="p">),</span>
             <span class="n">s</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;basemap location plot based on latitude and longitude&quot;</span><span class="p">)</span>

<span class="n">P</span><span class="o">.</span><span class="n">set_axis_bgcolor</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">)</span> <span class="c1">#Background Color</span>
</code></pre></div>

<p><img alt="png" src="/figures/20170218_twosigma_renthop_03.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">train</span><span class="o">.</span><span class="n">ix</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>(10933, 2)
</code></pre></div>

<p>We can plot the high and medium level location to have a look if there is any special location of these levels. But from the plot it does not show special locations.</p>
<div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;ggplot&#39;</span><span class="p">)</span>
<span class="n">new_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>  
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">new_style</span><span class="p">)</span>  

<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="c1">#Size of figure  </span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="n">P</span><span class="o">=</span><span class="n">train</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;interest_level == &quot;high&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
                                               <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">74.02</span><span class="p">,</span> <span class="o">-</span><span class="mf">73.85</span><span class="p">),</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">40.64</span><span class="p">,</span> <span class="mf">40.86</span><span class="p">),</span><span class="n">s</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;high level plot&quot;</span><span class="p">)</span>
<span class="n">P</span><span class="o">.</span><span class="n">set_axis_bgcolor</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">)</span> <span class="c1">#Background Color</span>
</code></pre></div>

<p><img alt="png" src="/figures/20170218_twosigma_renthop_04.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;ggplot&#39;</span><span class="p">)</span>
<span class="n">new_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>  
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">new_style</span><span class="p">)</span>  

<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="c1">#Size of figure  </span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="n">P</span><span class="o">=</span><span class="n">train</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;interest_level == &quot;medium&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
                                                 <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">74.02</span><span class="p">,</span> <span class="o">-</span><span class="mf">73.85</span><span class="p">),</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">40.64</span><span class="p">,</span> <span class="mf">40.86</span><span class="p">),</span><span class="n">s</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;medium level plot&quot;</span><span class="p">)</span>

<span class="n">P</span><span class="o">.</span><span class="n">set_axis_bgcolor</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">)</span> <span class="c1">#Background Color</span>
</code></pre></div>

<p><img alt="png" src="/figures/20170218_twosigma_renthop_05.png"></p>
<h3>1.5. check of price</h3>
<p>The 1st and 99th percentile of price is 1475 and 13000. To be reasonable, we can floor and cap at 500 to 20000 for price.</p>
<div class="highlight"><pre><span></span><code><span class="n">price_pct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">price</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">99</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="nb">print</span> <span class="n">price_pct</span>

<span class="n">train</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> 
                             <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]))</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>[1475.0, 1800.0, 6895.0, 13000.0]
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">train</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f94bd61f7d0&gt;
</code></pre></div>

<p><img alt="png" src="/figures/20170218_twosigma_renthop_06.png"></p>
<p>Let's have a look at the price level at each interest_level. To avoid the bias in case of outliers, we will use median to compare. As is shown, the high interest level has the lowest median price, the low interest level has the highest price. That is, the higher the price, the less interest it is.</p>
<p>The same conclusion is there for price per bedroom. We can also find the median bedrooms for hign and medium are 2 while the bedrooms for low level is 1.</p>
<div class="highlight"><pre><span></span><code><span class="n">train</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;interest_level&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nx">interest_level</span>
<span class="nx">high</span><span class="w">      </span><span class="mi">2400</span>
<span class="nx">low</span><span class="w">       </span><span class="mi">3300</span>
<span class="nx">medium</span><span class="w">    </span><span class="mi">2895</span>
<span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">price</span><span class="p">,</span><span class="w"> </span><span class="nx">dtype</span><span class="p">:</span><span class="w"> </span><span class="nx">int64</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">train</span><span class="p">[</span><span class="s1">&#39;pricetobedroom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">price</span> <span class="o">/</span> <span class="n">train</span><span class="o">.</span><span class="n">bedrooms</span>
<span class="n">train</span><span class="p">[</span><span class="s1">&#39;pricetobathroom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">price</span> <span class="o">/</span> <span class="n">train</span><span class="o">.</span><span class="n">bathrooms</span>

<span class="nb">print</span> <span class="n">train</span><span class="o">.</span><span class="n">ix</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;interest_level&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;bedrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;bathrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;pricetobedroom&#39;</span><span class="p">,</span> <span class="s1">&#39;pricetobathroom&#39;</span><span class="p">]]</span>\
<span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;interest_level&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>                price  bedrooms  bathrooms  pricetobedroom  pricetobathroom
interest_level                                                             
high             2400         2        1.0          1625.0           2300.0
low              3300         1        1.0          2700.0           2995.0
medium           2895         2        1.0          1887.5           2650.0
</code></pre></div>

<h3>1.6. locations having only one rating</h3>
<p>For hign interest ratings, there are about 20% locations only have high rating. For medium ratings, it is also about 20% of the locations only have medium ratings. For low ratings, there are about 33% of the locations only have low ratings. For the other locations, they have more than 1 ratings. For these locations only have one rating, shall we only predict one rating for them? Or at least we should take them out from modeling. </p>
<div class="highlight"><pre><span></span><code><span class="n">grp</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">])</span>
<span class="n">cnt1</span> <span class="o">=</span> <span class="n">grp</span><span class="o">.</span><span class="n">interest_level</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;interest_level_cnts&quot;</span><span class="p">)</span>
<span class="n">cnt2</span> <span class="o">=</span> <span class="n">grp</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;size&#39;</span><span class="p">)</span>
<span class="n">cnt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">cnt1</span><span class="p">,</span> <span class="n">cnt2</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">])</span>
<span class="n">cnt</span><span class="p">[</span><span class="s1">&#39;pct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt</span><span class="o">.</span><span class="n">interest_level_cnts</span> <span class="o">/</span> <span class="n">cnt</span><span class="o">.</span><span class="n">ix</span><span class="p">[:,</span> <span class="s1">&#39;size&#39;</span><span class="p">]</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">cnt</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;level_2 == &quot;high&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;pct&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pct</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>[]
</code></pre></div>

<p><img alt="png" src="/figures/20170218_twosigma_renthop_07.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">cnt</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;level_2 == &quot;medium&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;pct&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pct</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>[]
</code></pre></div>

<p><img alt="png" src="/figures/20170218_twosigma_renthop_08.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">cnt</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;level_2 == &quot;low&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;pct&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pct</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>[]
</code></pre></div>

<p><img alt="png" src="/figures/20170218_twosigma_renthop_09.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">cnt</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;level_2 == &quot;high&quot; &amp; pct &lt; 1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;pct&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pct</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f94b74a1e50&gt;
</code></pre></div>

<p><img alt="png" src="/figures/20170218_twosigma_renthop_10.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">cnt</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;level_2 == &quot;medium&quot; &amp; pct &lt; 1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;pct&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pct</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f94bdd6e350&gt;
</code></pre></div>

<p><img alt="png" src="/figures/20170218_twosigma_renthop_11.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">cnt</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;level_2 == &quot;low&quot; &amp; pct &lt; 1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;pct&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pct</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f94b75d3910&gt;
</code></pre></div>

<p><img alt="png" src="/figures/20170218_twosigma_renthop_12.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">cnt_mix</span> <span class="o">=</span> <span class="n">cnt</span><span class="o">.</span><span class="n">ix</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;pct&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;pct &lt; 1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">])</span>
<span class="n">train_mix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">cnt_mix</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">])</span>

<span class="nb">print</span> <span class="n">train_mix</span><span class="o">.</span><span class="n">ix</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;interest_level&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;bedrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;bathrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;pricetobedroom&#39;</span><span class="p">,</span> <span class="s1">&#39;pricetobathroom&#39;</span><span class="p">]]</span>\
<span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;interest_level&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>                price  bedrooms  bathrooms  pricetobedroom  pricetobathroom
interest_level                                                             
high             2600         2        1.0     1683.333333           2450.0
low              3345         1        1.0     2800.000000           3000.0
medium           2950         2        1.0     1950.000000           2700.0
</code></pre></div>

<h3>1.7. character variables</h3>
<p>displary_adress, description, features and street_address are the character variables. display_adress is not normalized characters, which have special characters like ' ,.$# ' and so on. We will first remove these special characters and then strip to remove leading and tailing blanks, and then compress to remove the multiple blanks in the middle. </p>
<p>After cleaning display_adress, wall st, broadway, e 34th st, second ave and w 37th st are the location with most listings.There are about 4k locations with only one listing.So either we don't include it in the model or we have to combine the address since it has too many levels.</p>
<p>A good way to display these characters is <a href="https://en.wikipedia.org/wiki/Tag_cloud">word cloud</a>. It shows the size of the character in accordance with its frequency: the higher the frequency of the character, the bigger the size is. The following will show how to draw the wordcloud.</p>
<div class="highlight"><pre><span></span><code><span class="n">train</span><span class="p">[</span><span class="s1">&#39;display_address2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">display_address</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;-,.$*!#&amp;</span><span class="se">\&#39;\t</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>\
                                                                         <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;street&#39;</span><span class="p">,</span> <span class="s1">&#39;st&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;avenue&#39;</span><span class="p">,</span> <span class="s1">&#39;ave&#39;</span><span class="p">)</span>\
                                                                         <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;west&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
<span class="n">train</span><span class="p">[</span><span class="s1">&#39;display_address2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)[:</span><span class="mi">20</span><span class="p">]</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nx">wall</span><span class="w"> </span><span class="nx">st</span><span class="w">          </span><span class="mi">451</span>
<span class="nx">broadway</span><span class="w">         </span><span class="mi">443</span>
<span class="nx">e</span><span class="w"> </span><span class="mi">34</span><span class="nx">th</span><span class="w"> </span><span class="nx">st</span><span class="w">        </span><span class="mi">441</span>
<span class="nx">w</span><span class="w"> </span><span class="nx">st</span><span class="w">             </span><span class="mi">412</span>
<span class="nx">second</span><span class="w"> </span><span class="nx">ave</span><span class="w">       </span><span class="mi">370</span>
<span class="nx">w</span><span class="w"> </span><span class="mi">37</span><span class="nx">th</span><span class="w"> </span><span class="nx">st</span><span class="w">        </span><span class="mi">370</span>
<span class="nx">john</span><span class="w"> </span><span class="nx">st</span><span class="w">          </span><span class="mi">346</span>
<span class="nx">gold</span><span class="w"> </span><span class="nx">st</span><span class="w">          </span><span class="mi">345</span>
<span class="nx">york</span><span class="w"> </span><span class="nx">ave</span><span class="w">         </span><span class="mi">316</span>
<span class="nx">washington</span><span class="w"> </span><span class="nx">st</span><span class="w">    </span><span class="mi">304</span>
<span class="nx">w</span><span class="w"> </span><span class="mi">42</span><span class="nx">nd</span><span class="w"> </span><span class="nx">st</span><span class="w">        </span><span class="mi">295</span>
<span class="nx">columbus</span><span class="w"> </span><span class="nx">ave</span><span class="w">     </span><span class="mi">292</span>
<span class="nx">lexington</span><span class="w"> </span><span class="nx">ave</span><span class="w">    </span><span class="mi">283</span>
<span class="nx">e</span><span class="w"> </span><span class="mi">39</span><span class="nx">th</span><span class="w"> </span><span class="nx">st</span><span class="w">        </span><span class="mi">281</span>
<span class="nx">water</span><span class="w"> </span><span class="nx">st</span><span class="w">         </span><span class="mi">280</span>
<span class="nx">first</span><span class="w"> </span><span class="nx">ave</span><span class="w">        </span><span class="mi">268</span>
<span class="nx">e</span><span class="w"> </span><span class="mi">79</span><span class="nx">th</span><span class="w"> </span><span class="nx">st</span><span class="w">        </span><span class="mi">253</span>
<span class="nx">e</span><span class="w"> </span><span class="mi">35</span><span class="nx">th</span><span class="w"> </span><span class="nx">st</span><span class="w">        </span><span class="mi">251</span>
<span class="nx">w</span><span class="w"> </span><span class="mi">54</span><span class="nx">th</span><span class="w"> </span><span class="nx">st</span><span class="w">        </span><span class="mi">240</span>
<span class="nx">e</span><span class="w"> </span><span class="mi">89</span><span class="nx">th</span><span class="w"> </span><span class="nx">st</span><span class="w">        </span><span class="mi">238</span>
<span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">display_address2</span><span class="p">,</span><span class="w"> </span><span class="nx">dtype</span><span class="p">:</span><span class="w"> </span><span class="nx">int64</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">wordcloud</span> <span class="kn">import</span> <span class="n">WordCloud</span>
<span class="n">display_address_word</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;display_address2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">wordcloud</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">max_font_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_words</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">display_address_word</span><span class="p">)</span>
<span class="n">wordcloud</span><span class="o">.</span><span class="n">recolor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordcloud</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Wordcloud for display address&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="/figures/20170218_twosigma_renthop_13.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">display_address_word2</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">display_address</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">wordcloud</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">max_font_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_words</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">display_address_word2</span><span class="p">)</span>
<span class="n">wordcloud</span><span class="o">.</span><span class="n">recolor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordcloud</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Wordcloud for display address&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="/figures/20170218_twosigma_renthop_14.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">feature_list</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">feature_list_all</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">feature_list</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
<span class="n">feature_list_all_norm</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)),</span> <span class="n">feature_list_all</span><span class="p">)</span>
<span class="n">feature_list_all_norm_</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">feature_list_all_norm</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">wordcloud</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">max_font_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_words</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">feature_list_all_norm_</span><span class="p">)</span>
<span class="n">wordcloud</span><span class="o">.</span><span class="n">recolor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordcloud</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Wordcloud for features&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="/figures/20170218_twosigma_renthop_15.png"></p>
<h2>2. Distribution of y on x</h2>
<p>From above analysis we got the clue that number of bedrooms and price are the two very important variables. Here we will show a little more relation between y and x.</p>
<h3>2.1. high/low/medium counts on number of bedrooms</h3>
<p>For each number of bedrooms(0, 1, 2...) we can count how many times high/low/medium occurs. From the graph below, the 1 bedroom occurs most, next by two bedrooms, and then 0 bedrooms. For each of these, low appers most, then medium. hign appears least.</p>
<div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;bedrooms&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;interest_level&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Interest_level frequency&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;bedrooms&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="/figures/20170218_twosigma_renthop_16.png"></p>
<p>But this only tell us the counts. It does not tell us the distribution of interest_level on different bedrooms. Next we will calculate the percentage.</p>
<p>From the analysis, we can find low rate is a little high on bedroom=1 than the others from 0 to 4. On 5, 6, 7 and 8, the low rate is very high which is almost 1. So we can have the rough conclusion that if bedrooms is more than or equal to 5, it is very likely it will be low interest.</p>
<div class="highlight"><pre><span></span><code><span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">/</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;bedrooms&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">interest_level</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="mf">.9</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span> 
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">)),</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">get_height</span><span class="p">()),</span> \
                <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">)</span> 

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;percentage*100&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&lt;matplotlib.text.Text at 0x7f94bddf2750&gt;
</code></pre></div>

<p><img alt="png" src="/figures/20170218_twosigma_renthop_17.png"></p>
<h3>2.2. counts of features v.s. y</h3>
<p>Features is a list with different kind of keywords. We can apply text mining on it. But the easiest way if to check the feqture keyword counts v.s. y.</p>
<p>From the feature_cnt histogram, there is only few with more than 15 features. so we will cap at 15. </p>
<p>From the percentage plot, we can find features count from 0 to 3, low interest is increasing, medium interest is decreasing. After 4, low interest is decreasing and medium interest is increasing. For high interest, it is high on two tails(start and end), and it is low in the center.</p>
<div class="highlight"><pre><span></span><code><span class="n">train</span><span class="p">[</span><span class="s1">&#39;feature_cnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="n">train</span><span class="p">[</span><span class="s1">&#39;feature_cnt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">train</span><span class="p">[</span><span class="s1">&#39;feature_cnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;feature_cnt&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">15</span><span class="p">,</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;feature_cnt&#39;</span><span class="p">],</span> <span class="mi">15</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">/</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;feature_cnt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">interest_level</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="mf">.9</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span> 
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">)),</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">get_height</span><span class="p">()),</span> \
                <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">)</span> 

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;percentage*100&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&lt;matplotlib.text.Text at 0x7f94bdb6ddd0&gt;
</code></pre></div>

<p><img alt="png" src="/figures/20170218_twosigma_renthop_18.png"></p>
<p><img alt="png" src="/figures/20170218_twosigma_renthop_19.png"></p>
<p>Another popular plot to show the realtion at different level is <a href="https://en.wikipedia.org/wiki/Violin_plot">violin plot</a>. </p>
<div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">&quot;feature_cnt&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;interest_level&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span><span class="s1">&#39;high&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;interest_level&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of features&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="/figures/20170218_twosigma_renthop_20.png"></p>
<p>Next we will begin to build models based on the analysis above.</p></div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">
        <a href="/author/huiming-song.html">Huiming Song</a>
    </span>
  </span>
<time datetime="2017-02-18T00:00:00-06:00" pubdate>Sat 18 February 2017</time>  <span class="categories">
    <a class='category' href='/category/python.html'>Python</a>
  </span>
  <span class="categories">
    <a class="category" href="/tag/python.html">python</a>,    <a class="category" href="/tag/data-visualization.html">data visualization</a>,    <a class="category" href="/tag/matplotlib.html">matplotlib</a>,    <a class="category" href="/tag/data-minging.html">data minging</a>  </span>
</p><div class="sharing">
</div>    </footer>
  </article>

</div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="/pages/2025/02/16/deepseek-v3/">DeepSeek V3</a>
      </li>
      <li class="post">
          <a href="/pages/2023/10/01/image-generation-2-latent-diffusion-model-stable-diffusion/">Image Generation 2: Latent Diffusion model / Stable Diffusion</a>
      </li>
      <li class="post">
          <a href="/pages/2023/07/04/image-generation-1-diffusion-model/">Image Generation 1: Diffusion model</a>
      </li>
      <li class="post">
          <a href="/pages/2023/05/28/gpt-1-gpt-2-gpt-3-instructgpt-chatgpt-and-gpt-4-summary/">GPT-1, GPT-2, GPT-3, InstructGPT / ChatGPT and GPT-4 summary</a>
      </li>
      <li class="post">
          <a href="/pages/2021/12/31/recommendation-system-05-bayesian-optimization/">Recommendation System 05 - Bayesian Optimization</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="/category/career-growth.html">career growth</a></li>
        <li><a href="/category/linux.html">Linux</a></li>
        <li><a href="/category/python.html">python</a></li>
        <li><a href="/category/rthers.html">Rthers</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="/tag/python.html">python</a>,    <a href="/tag/ai.html">AI</a>,    <a href="/tag/llm.html">LLM</a>,    <a href="/tag/aig.html">AIG</a>,    <a href="/tag/data-mining.html">data mining</a>,    <a href="/tag/sklearn.html">sklearn</a>,    <a href="/tag/pytorch.html">pytorch</a>,    <a href="/tag/career-growth.html">career growth</a>,    <a href="/tag/linux.html">linux</a>,    <a href="/tag/deep-learning.html">deep learning</a>,    <a href="/tag/leetcode.html">leetcode</a>,    <a href="/tag/dynamic-programming.html">dynamic programming</a>,    <a href="/tag/flask.html">flask</a>,    <a href="/tag/highcharts.html">highcharts</a>,    <a href="/tag/sql.html">sql</a>,    <a href="/tag/webcrawl.html">webCrawl</a>,    <a href="/tag/random-walk.html">random walk</a>,    <a href="/tag/multiprocessing.html">multiprocessing</a>,    <a href="/tag/data-visualization.html">data visualization</a>,    <a href="/tag/numpy.html">numpy</a>,    <a href="/tag/tensorflow.html">tensorflow</a>,    <a href="/tag/quant.html">quant</a>,    <a href="/tag/statsmodels.html">statsmodels</a>,    <a href="/tag/pandas.html">pandas</a>,    <a href="/tag/docker.html">docker</a>,    <a href="/tag/matplotlib.html">matplotlib</a>,    <a href="/tag/data-minging.html">data minging</a>,    <a href="/tag/remote-access.html">remote access</a>,    <a href="/tag/mysql.html">mysql</a>,    <a href="/tag/base.html">base</a>,    <a href="/tag/tweepy.html">tweepy</a>,    <a href="/tag/bokeh.html">bokeh</a>,    <a href="/tag/sentiment-analysis.html">sentiment analysis</a>,    <a href="/tag/map.html">map</a>,    <a href="/tag/apply.html">apply</a>,    <a href="/tag/apply_async.html">apply_async</a>,    <a href="/tag/git.html">git</a>,    <a href="/tag/pyqt.html">PyQt</a>,    <a href="/tag/cx_freeze.html">cx_freeze</a>,    <a href="/tag/tkinter.html">tkinter</a>,    <a href="/tag/pelican.html">pelican</a>,    <a href="/tag/spyre.html">spyre</a>,    <a href="/tag/shiny.html">shiny</a>,    <a href="/tag/r.html">R</a>,    <a href="/tag/re.html">re</a>  </section>


    <section>
        <h1>Social</h1>
        <ul>
            <li><a href="https://www.linkedin.com/pub/huiming-song/24/735/349" target="_blank">Linkedin</a></li>
        </ul>
    </section>
    <section>
        <h1>Blogroll</h1>
        <ul>
            <li><a href="http://easysas.blogspot.com/" target="_blank">my old SAS blog</a></li>
        </ul>
    </section>

</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2015&ndash;2025  shm &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="/theme/js/modernizr-2.0.js"></script>
  <script src="/theme/js/ender.js"></script>
  <script src="/theme/js/octopress.js" type="text/javascript"></script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-65938411-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-65938411-1');
    ga('send', 'pageview');
</script>
  <script type="text/javascript">
    var disqus_shortname = 'songhuiming';
    var disqus_identifier = '/pages/2017/02/18/exploratory-analysis-of-two-sigma-connect-rental-listing-inquiries/';
    var disqus_url = '/pages/2017/02/18/exploratory-analysis-of-two-sigma-connect-rental-listing-inquiries/';
    var disqus_title = 'Exploratory analysis of Two Sigma Connect: Rental Listing Inquiries';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
</body>
</html>